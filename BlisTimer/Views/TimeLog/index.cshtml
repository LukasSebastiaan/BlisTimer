@model List<Domain.Models.TimeLog>

@{
    Layout = "_HomeLayout";
}

<script>
    function submitHours() {
        alert("Your hours are being submitted, this make take a few minutes.");
        
        $.ajax({
          type: "POST",
          url: "/TimeLog/PostHoursToSimplicate",
            data: "{}",
            success: function (result) {
              location.reload();
            },
            error: function (result) {
              alert(result.responseText);
            }
        })
    }
</script>

<style>
    a.editButton{
        color: white;
        border: 2px solid white;
        border-radius: 15%;
        text-decoration: none;
        padding: 8% 17%;
    }
    tr:hover a.editButton{
        color: black;
        border: 2px solid black;
    }

    #buttons{
        display: flex;
        justify-content: right;
        width: 550px;
        margin: 5vh auto 0 50vw;
        transform: translate(0, -315%);
    }

    #submitButton, input[type="button"]{
        color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 8px 16px;
        text-decoration: none;
        margin: 0 2px;
    }

    input[type="button"]:not(.active){
        background-color: transparent;
    }

    .active{
        background-color: var(--blis-cyan);
        color: #fff;
    }

    input[type="button"]:hover:not(.active){
        background-color: #ddd;
    }

    #submitHoursContainer, #totalTimeContainer{
        display: flex;
        justify-content: left;
        width: 550px;
    }
    #submitHoursContainer{
        margin: 3vh 50vw 0 auto;
    }
    #totalTimeContainer{
        margin: 1vh 50vw 0 auto;
    }
    #submitButton:hover{
        background-color: #ddd;
    }

    @@media (max-width: 1100px)
    {
        #submitHoursContainer, #totalTimeContainer{
            width: 48.5vw;
            justify-content: left;
        }
        #buttons{
            width: 48.5vw;
            justify-content: right;
        }
    }
    @@media (max-width: 850px)
    {
        html{
            overflow: auto;
        }
        tr#header{
            display: none;
        }
        td{
            display: block;
        }
        td:first-child{
            background-color: var(--blis-cyan);
            text-align: center;
            color: black;
            font-weight: 600;
        }
        td:nth-child(2)::before{
            content: "Activity: ";
        }
        td:nth-child(3)::before{
             content: "Start time: ";
        }
        td:nth-child(4)::before{
            content: "End time: ";
        }
        td:nth-child(5)::before{
            content: "Hours Worked: ";
        }
        td:nth-child(6)::before {
            content: "Hourtype: ";
        }
        a.editButton{
            padding: 1% 3%;
        }

        #buttons, #submitHoursContainer, #totalTimeContainer{
            width: unset;
            justify-content: center;
        }
        #buttons{
            transform: translate(0, -324%);
        }
        #submitButton{
            transform: translate(-22%, -10%);
        }
        input.pageButtons, input.active{
            display: none;
        }
    }
</style>

<div class="main">
    <h1>Time overview</h1>
    <hr>
    @if (Model.Count == 0) {
        <div id="noRecordsContainer">
            <h2>Whoops, no existing records</h2>
        </div>
    }
    else
    {
        <div id="time-table">
            <table id="logTable">
                <thead>
                    <tr id="header">
                        <th>Project</th>
                        <th>Activity</th>
                        <th>StartTime</th>
                        <th>EndTime</th>
                        <th>Hours Worked</th>
                        <th>HourType</th>
                        <th>Handle</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var timelog in Model)
                    {
                        <tr>
                            <td>@timelog.Activity.Project.Name</td>
                            <td>@timelog.Activity.Name</td>
                            <td>@timelog.StartTime</td>
                            <td>@timelog.EndTime</td>
                            <td>
                                @{var workedHours = timelog.EndTime - timelog.StartTime;}
                                @workedHours.Hours.ToString("0#"):@workedHours.Minutes.ToString("0#")
                            </td>
                            <td>@timelog.HourType.Label</td>
                            <td>
                                <a class="editButton" asp-controller="TimeLog" asp-action="Edit" asp-route-id="@timelog.Id">Edit</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div id="submitHoursContainer">
            <a id="submitButton" onclick="submitHours()">Submit hours</a>
        </div>
        <div id="totalTimeContainer">
            <p>Total time worked: @ViewBag.totalTime</p>
        </div>
    }
</div>

<script>
    var $table = document.getElementById("logTable"),
        $div = document.getElementById("totalTimeContainer"),
        $rowsPerPage = 4,
        $rowCount = $table.rows.length,
        $firstRow = $table.rows[0].firstElementChild.tagName,
        // Check if table has a head row
        $hasHead = ($firstRow === "TH"),
        // Array to hold each row
        $tr = [],
        // Count vars, counts from 2nd row if first is "th"
        $i, $ii, $j = ($hasHead) ? 1 : 0,
        // Holds first row if it has "th", nothing "td"
        $th = ($hasHead ? $table.rows[(0)].outerHTML : "");
    if ($rowCount % $rowsPerPage <= 1) {
        $pageCount = Math.floor($rowCount / $rowsPerPage);
    } else {
        $pageCount = Math.ceil($rowCount / $rowsPerPage);
    }
    // Does something if we have more than 1 page
    if ($pageCount > 1) {
        // Assigns each table row to table
        for ($i = $j, $ii = 0; $i < $rowCount; $i++, $ii++)
            $tr[$ii] = $table.rows[$i].outerHTML;
        // Div block for the buttons
        $div.insertAdjacentHTML("afterend", "<div id='buttons'></div");
        // Set default page (first amount of rows)
        sort(1);
    }

    function sort($selectedPage) {
        // Rows holds group rows, startpoint is first row on each page
        var $rows = $th, $startPoint = (($rowsPerPage * $selectedPage) - $rowsPerPage);
        for ($i = $startPoint; $i < ($startPoint + $rowsPerPage) && $i < $tr.length; $i++)
            $rows += $tr[$i];

        $table.innerHTML = $rows;
        // Creates pagination buttons
        document.getElementById("buttons").innerHTML = pageButtons($pageCount, $selectedPage);
        document.getElementById("id" + $selectedPage).setAttribute("class", "active");
    }

    function pageButtons($pageCount, $currentPage) {
        // Disables buttons on first and last page
        var $prevDis = ($currentPage == 1) ? "disabled" : "",
            $nextDis = ($currentPage == $pageCount) ? "disabled" : "",
            
            // Holds the buttons 
            $buttons = "<input type='button' id='prevButton' value='<< Prev' onclick='sort(" + ($currentPage - 1) + ")' " + $prevDis + ">";
        $buttons += "<input type='button' id='nextButton' value='Next >>' onclick='sort(" + ($currentPage + 1) + ")' " + $nextDis + ">";
        return $buttons;
    }
</script>